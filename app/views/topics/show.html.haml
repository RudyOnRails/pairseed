.row
  .span1
    =image_tag avatar_url(@topic.user)
  .span8
    %h1
      =raw @topic.title 
  .span1
    -unless cannot? :manage, @topic
      =link_to "Edit", edit_topic_path, :class => 'btn btn-small'
      =link_to "Delete", topic_path, :method => :delete, :class => 'btn btn-small btn-danger', :confirm => "Are you sure you want to delete this topic?"
.row.top-buffer
  .span10
    -if can? :manage, @topic
      %ul.nav.nav-tabs#myTab
        -if @topic.scheduled?
          %li.active=link_to "Appointment", "#appointment", :"data-toggle" => "tab"
          %li=link_to "Offers", "#offers", :"data-toggle" => "tab"
        -else
          %li.active=link_to "Offers", "#offers", :"data-toggle" => "tab"
      .tab-content
        .tab-pane#offers{:class => ("active" unless @topic.scheduled?)}
          .table
            %table
              %tr
                %th
                %th From
                %th Message
                %th When
                %th Where
              -@offers.each do |offer|
                %tr{:class => offer_tr_class(offer)}
                  -if offer.acceptable?
                    %td=link_to "Accept", accept_offer_path(:id => offer.id), :class => "btn btn-success"
                  -else
                    %td=offer.state
                  %td=offer.user.full_name
                  %td=offer.message
                  %td=offer.suggested_datetime
                  %td=offer.suggested_place
        .tab-pane.active#appointment
          -unless !@topic.scheduled?
            =@appointment.date_and_time
            =link_to "Cancel", cancel_appointment_path(@appointment.id), :class => "btn btn-danger"

    -else
      -if current_user.has_not_offered_help?(@topic.id, current_user.id)
        .offset1.span8
          =form_for @offer do |f|
            %fieldset
              =f.hidden_field :topic_id, :value => @topic.id
              .control-group.span4
                =f.label :message, "Message"
                .controls
                  =f.text_area :message, :class => 'span4', :rows => 10
              .control-group.span2
                =f.label :suggested_place, "Suggest a place..."
                .controls
                  =f.text_field :suggested_place
                =f.label :suggested_datetime, "Suggest a day & time..."
                .controls
                  =f.text_field :suggested_datetime
                .action
                  =f.submit "Send Offer", :class => 'btn btn-success'
      -else
        =@my_offer.message





